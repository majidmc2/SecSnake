# in BackgroundScript code we define some main variable like:
#  origin
#  port
#  path
#  protocol
#  ...


---
- name: example attack
  tasks:
    - name: test elements 

    	element: 
        set_interval: 3000 # optional 3000 ms = 3 s
        select_by_id: main
        attribute:
          onclick:
            event_attribute:
              condition: if_encode and if_send_data_to_other_origin or if_recive_data_from_other_origin and if_change_location and if_equal and if_regexp
            check: 
                data: '<script>alert('XSS')</script>'
                # or
                signatures: /home/stored-xss-signatures.txt
            regexp: 
              data: '<script>/\w{*}/</script>'
              # or
              signatures: /home/reflected-xss-signatures.txt
            condition:  (regexp or check) or event_attribute
          action:  ### it is oter sample of attribute
            check: 
              data: {{ !origin }}
              # or
              signatures: /home/stored-xss-signatures.txt
            condition: check
          condition: action and onclick

        inner_html:
          has_script:  # Find all of scripts
            condition: if_regexp and if_equal and if_encode or if_send_data_to_other_origin or if_recive_data_from_other_origin and if_change_location 
          regexp:
            data: '<script>/\w{*}/</script>'
            # or
            signatures: /home/stored-xss-signatures.txt
          check: 
            value: '<p id="child-of-main" onclick="alert('HI-22222')">Test</p>'
            # or
            signatures: /home/stored-xss-signatures.txt
          condition: (regexp or check) and has_script

        text_content:  # for detection Phishing with weight of word
          banck: 
            if_counter_equal: 
              value: 10
            if_counter_less_than: 
              value: 20
            if_counter_more_than: 
              value: 33
            if_weight_equal: 
              value: 0.99
            if_weight_less_than: 
              value: 0.37
            if_mweight_ore_than: 
              value: 0.79
            condition: if_counter_equal and if_counter_less_than or if_counter_more_than and if_weight_equal and if_weight_less_than and if_mweight_ore_than
          cv2:
            if_mweight_ore_than: 
              value: 0.79
            condition: if_mweight_ore_than
          condition: cv2 and banck

        css: 
          opacity:
            if_equal: 
              value: 0.5
              change: 1
              # or
              signatures: /home/stored-xss-signatures.txt
            if_less_than: 
              value: 0.3
              change: 0
            if_more_than: 
              value: 0.7
              change: 1
            condition: if_equal and if_less_than or if_more_than
          z-index:
            if_equal: 
              value: 0
              change: 1
            condition: if_equal
          condition: opacity and z-index

        condition: (css and attribute) or (inner_html and text_content)
         do:
          - notification
          - log
          - prevant_default
          - prevant_sending_auth_header
          - prevant_sending_coockie


      on_before_request:
        ## But user browser.webRequest.onBeforeSendHeaders becuase it has all parameters and has header
        ## check with Google Safe browsing
        ## It can also underestand window.location.href change!!!
        ## It can not work for other extentions: https://stackoverflow.com/questions/46222289/how-to-intercept-other-extensions-requests-using-chrome-extension-api
        url:
          data: https://hacker.com
          #or
          signatures: /home/block-url.txt
        documentUrl:
          data: https://google.com
          #or
          signatures: /home/block-url.txt
        originUrl:
         data: {{ !origin }}
         #or
         signatures: /home/block-url.txt
        method:  # OR Base
          - POST 
          - GET
        frameId: 444
        parentFrameId: 0
        type:  # OR Base
          - object
          - object_subrequest
          - script
          - stylesheet
        do:
          - notification
          - log
          - block
          - prevant_sending_auth_header
          - prevant_sending_coockie


      spatial_user_scripts:
        ## register user ContentScript


### Other ways of Selection Element
# select_by_tah_name: 
  # counter:
# select_by_class_name:
  # counter: 
# select_by_query:
# select_by_query_all: 
  # counter:
# select_body: 
# select_head: 
# select_images: 
# select_forms: 
### select_iframes:

